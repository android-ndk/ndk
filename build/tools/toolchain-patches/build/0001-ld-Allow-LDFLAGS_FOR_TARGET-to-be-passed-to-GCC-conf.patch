From 267e5c13d0ca673d6dd235d0b0745af149304875 Mon Sep 17 00:00:00 2001
From: David 'Digit' Turner <digit@google.com>
Date: Tue, 7 Feb 2012 14:18:06 +0100
Subject: ld: Allow LDFLAGS_FOR_TARGET to be passed to GCC configure script.

This patch is a small hack that allows the value of LDFLAGS_FOR_TARGET
as defined when the build configure script is invoked to be passed
also to the GCC build script.

This is necessary to build the x86 NDK toolchain. Probably not the
cleanest way to do it though, so the compiler team may want something
else for the sources on android.googlesource.com.
---
 Makefile.in  |    2 +-
 configure    |   39 ++++++++++++++++++++++++---------------
 configure.ac |    1 +
 3 files changed, 26 insertions(+), 16 deletions(-)

diff --git a/Makefile.in b/Makefile.in
index ea3bd2d..0b73ff6 100644
--- a/Makefile.in
+++ b/Makefile.in
@@ -148,7 +148,7 @@ export	CC_FOR_TARGET="$(TARGET_GCC_BUILDDIR)/gcc/xgcc \
 #
 CFLAGS_FOR_TARGET+= -O2 -Os -g
 CXXFLAGS_FOR_TARGET+=$(CFLAGS_FOR_TARGET)
-LDFLAGS_FOR_TARGET=
+LDFLAGS_FOR_TARGET=@LDFLAGS_FOR_TARGET@
 
 # Helper
 prefix-list = $(foreach e, $(2), $(join $1, $e))
diff --git a/configure b/configure
index e7c02f8..236fb93 100755
--- a/configure
+++ b/configure
@@ -581,6 +581,7 @@ gold_baseargs
 enable_gold
 baseargs
 TOPLEVEL_CONFIGURE_ARGUMENTS
+LDFLAGS_FOR_TARGET
 GDB_TARGET
 BUILD_ANDROID_GCC
 INSTALL_DATA
diff --git a/configure.ac b/configure.ac
index b4d56bb..ee13f88 100644
--- a/configure.ac
+++ b/configure.ac
@@ -54,6 +54,7 @@ case $target in
 esac
 AC_SUBST(BUILD_ANDROID_GCC)
 AC_SUBST(GDB_TARGET)
+AC_SUBST(LDFLAGS_FOR_TARGET)
 AC_ARG_PROGRAM
 
 # TOPLEVEL_CONFIGURE_ARGUMENTS lifted from top-level configure.ac in gcc.
-- 
1.7.6.rc0

